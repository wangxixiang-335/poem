import{h as ce,d as de,r as g,c as M,k as ue,_ as ve,b as c,f as S,e,g as he,v as me,l as U,t as l,F as j,m as A,w as O,j as d,a as xe,u as Oe,p as Be,q as Re,n as z,i as X,s as re}from"./index-CSK4OVOp.js";function Te(u,s){return new Promise((n,t)=>{const F=setTimeout(()=>{const b={mood:`《${u.title}》营造了一种${u.dynasty==="唐代"?"清新淡雅":"婉约深沉"}的意境。作者${u.author}通过细腻的情感表达，将${u.dynasty==="唐代"?"对自然的热爱与人生的感悟":"内心的思考与情感的波澜"}娓娓道来，让读者仿佛置身其中，感受到那份${u.title.includes("思")?"思乡之情":u.title.includes("春")?"春日之美":"人生感慨"}。`,rhetoric:`这首诗运用了多种修辞手法：${u.content.includes("明月")?"以月为意象，寓情于景":""}${u.content.includes("花")?"借花喻人，情景交融":""}${u.content.includes("水")||u.content.includes("江")?"以水喻情，动静结合":""}。诗人巧妙地运用${u.dynasty==="宋代"?"典型的宋词手法，词句优美，韵律和谐":"唐诗的格律严谨，对仗工整"}，使得整首诗读来朗朗上口，意境深远。`,background:`${u.title}创作于${u.dynasty}，正值${u.dynasty==="唐代"?"唐朝文化繁荣，诗歌创作达到巅峰":u.dynasty==="宋代"?"宋代文人雅士盛行，词风婉约":"文学发展的重要时期"}。${u.author}作为${u.dynasty}著名诗人，其作品往往反映了当时的社会风貌与个人情怀。这首诗的创作背景可能与作者的${u.title.includes("思")?"思乡经历":u.title.includes("春")?"春日感怀":"人生感悟"}密切相关。`,commentary:`《${u.title}》堪称${u.dynasty}诗歌的经典之作。全诗结构严谨，层次分明，从${u.content.split("，")[0]||"开篇"}入手，逐步展开情感的抒发。${u.author}以其深厚的文学功底和敏锐的情感触觉，将${u.title.includes("静")?"静谧的夜晚":u.title.includes("春")?"春日的美好":"人生的感悟"}描绘得淋漓尽致。这首诗不仅在当时广为传颂，至今仍被人们所喜爱，足见其艺术价值和文学地位。`};n(b)},1500);s&&s.addEventListener("abort",()=>{clearTimeout(F),t(new Error("请求已取消"))})})}const Me=[{id:"libai_1",title:"静夜思",author:"李白",dynasty:"唐代",content:"床前明月光，疑是地上霜。举头望明月，低头思故乡。",preview:"床前明月光，疑是地上霜。举头望明月，低头思故乡。",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg"},{id:"libai_2",title:"望庐山瀑布",author:"李白",dynasty:"唐代",content:"日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺，疑是银河落九天。",preview:"日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺，疑是银河落九天。",image:"https://ai-public.mastergo.com/ai/img_res/437f5006c8faaf74d6d7d4197e1d9482.jpg"},{id:"libai_3",title:"早发白帝城",author:"李白",dynasty:"唐代",content:"朝辞白帝彩云间，千里江陵一日还。两岸猿声啼不住，轻舟已过万重山。",preview:"朝辞白帝彩云间，千里江陵一日还。两岸猿声啼不住，轻舟已过万重山。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg"},{id:"dufu_1",title:"春望",author:"杜甫",dynasty:"唐代",content:"国破山河在，城春草木深。感时花溅泪，恨别鸟惊心。烽火连三月，家书抵万金。白头搔更短，浑欲不胜簪。",preview:"国破山河在，城春草木深。感时花溅泪，恨别鸟惊心。烽火连三月，家书抵万金。",image:"https://ai-public.mastergo.com/ai/img_res/43e7125fe4023d89a1774e4416e1ace4.jpg"},{id:"dufu_2",title:"登高",author:"杜甫",dynasty:"唐代",content:"风急天高猿啸哀，渚清沙白鸟飞回。无边落木萧萧下，不尽长江滚滚来。",preview:"风急天高猿啸哀，渚清沙白鸟飞回。无边落木萧萧下，不尽长江滚滚来。",image:"https://ai-public.mastergo.com/ai/img_res/f0be731204399b0b196cea3d7505fdd2.jpg"},{id:"sushi_1",title:"水调歌头",author:"苏轼",dynasty:"宋代",content:"明月几时有？把酒问青天。不知天上宫阙，今夕是何年。我欲乘风归去，又恐琼楼玉宇，高处不胜寒。",preview:"明月几时有？把酒问青天。不知天上宫阙，今夕是何年。我欲乘风归去，又恐琼楼玉宇...",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg"},{id:"sushi_2",title:"念奴娇·赤壁怀古",author:"苏轼",dynasty:"宋代",content:"大江东去，浪淘尽，千古风流人物。故垒西边，人道是，三国周郎赤壁。",preview:"大江东去，浪淘尽，千古风流人物。故垒西边，人道是，三国周郎赤壁。",image:"https://ai-public.mastergo.com/ai/img_res/437f5006c8faaf74d6d7d4197e1d9482.jpg"},{id:"wangwei_1",title:"相思",author:"王维",dynasty:"唐代",content:"红豆生南国，春来发几枝。愿君多采撷，此物最相思。",preview:"红豆生南国，春来发几枝。愿君多采撷，此物最相思。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg"},{id:"baijuyi_1",title:"琵琶行",author:"白居易",dynasty:"唐代",content:"浔阳江头夜送客，枫叶荻花秋瑟瑟。主人下马客在船，举酒欲饮无管弦。",preview:"浔阳江头夜送客，枫叶荻花秋瑟瑟。主人下马客在船，举酒欲饮无管弦。",image:"https://ai-public.mastergo.com/ai/img_res/43e7125fe4023d89a1774e4416e1ace4.jpg"},{id:"lishangyin_1",title:"锦瑟",author:"李商隐",dynasty:"唐代",content:"锦瑟无端五十弦，一弦一柱思华年。庄生晓梦迷蝴蝶，望帝春心托杜鹃。",preview:"锦瑟无端五十弦，一弦一柱思华年。庄生晓梦迷蝴蝶，望帝春心托杜鹃。",image:"https://ai-public.mastergo.com/ai/img_res/f0be731204399b0b196cea3d7505fdd2.jpg"},{id:"xinqiji_1",title:"青玉案·元夕",author:"辛弃疾",dynasty:"宋代",content:"东风夜放花千树，更吹落、星如雨。宝马雕车香满路。凤箫声动，玉壶光转，一夜鱼龙舞。",preview:"东风夜放花千树，更吹落、星如雨。宝马雕车香满路。凤箫声动，玉壶光转...",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg"},{id:"liqingzhao_1",title:"声声慢",author:"李清照",dynasty:"宋代",content:"寻寻觅觅，冷冷清清，凄凄惨惨戚戚。乍暖还寒时候，最难将息。",preview:"寻寻觅觅，冷冷清清，凄凄惨惨戚戚。乍暖还寒时候，最难将息。",image:"https://ai-public.mastergo.com/ai/img_res/437f5006c8faaf74d6d7d4197e1d9482.jpg"},{id:"mazhiyuan_1",title:"天净沙·秋思",author:"马致远",dynasty:"元代",content:"枯藤老树昏鸦，小桥流水人家，古道西风瘦马。夕阳西下，断肠人在天涯。",preview:"枯藤老树昏鸦，小桥流水人家，古道西风瘦马。夕阳西下，断肠人在天涯。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg"},{id:"xuzhimo_1",title:"再别康桥",author:"徐志摩",dynasty:"现代",content:"轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。",preview:"轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。",image:"https://ai-public.mastergo.com/ai/img_res/43e7125fe4023d89a1774e4416e1ace4.jpg"}];function le(u,s){return new Promise((n,t)=>{const F=setTimeout(()=>{const b=u.keyword.toLowerCase().trim(),m=Me.filter(f=>!!(f.title.toLowerCase().includes(b)||f.author.toLowerCase().includes(b)||f.content.toLowerCase().includes(b)||f.dynasty.toLowerCase().includes(b))),k=u.page||1,w=u.limit||10,C=(k-1)*w,D=C+w,E={poems:m.slice(C,D),total:m.length,page:k,limit:w};n(E)},500);s&&s.addEventListener("abort",()=>{clearTimeout(F),t(new Error("搜索已取消"))})})}const x=ce;class T{static async getAll(s){try{const n=await x.get("/poems",{params:s});if(n.success)return n.data;throw new Error(n.message||"获取诗词列表失败")}catch(n){throw console.error("获取诗词列表失败:",n),new Error(n.message||"网络错误")}}static async getById(s){try{const n=await x.get(`/poems/${s}`);if(n.success)return n.data;throw new Error(n.message||"获取诗词详情失败")}catch(n){throw console.error("获取诗词详情失败:",n),new Error(n.message||"网络错误")}}static async create(s){try{const n=await x.post("/poems",s);if(n.success)return n.data;throw new Error(n.message||"创建诗词失败")}catch(n){throw console.error("创建诗词失败:",n),new Error(n.message||"网络错误")}}static async createBatch(s){try{const n=await x.post("/poems/batch",{poems:s});if(n.success)return n.data;throw new Error(n.message||"批量创建诗词失败")}catch(n){throw console.error("批量创建诗词失败:",n),new Error(n.message||"网络错误")}}static async update(s,n){try{const t=await x.put(`/poems/${s}`,n);if(t.success)return t.data;throw new Error(t.message||"更新诗词失败")}catch(t){throw console.error("更新诗词失败:",t),new Error(t.message||"网络错误")}}static async toggleFavorite(s){try{const n=await x.patch(`/poems/${s}/favorite`);if(n.success)return n.data;throw new Error(n.message||"切换收藏状态失败")}catch(n){throw console.error("切换收藏状态失败:",n),new Error(n.message||"网络错误")}}static async delete(s){try{const n=await x.delete(`/poems/${s}`);if(n.success)return n.data;throw new Error(n.message||"删除诗词失败")}catch(n){throw console.error("删除诗词失败:",n),new Error(n.message||"网络错误")}}static async getFavorites(){try{const s=await x.get("/poems/favorites/list");if(s.success)return s.data;throw new Error(s.message||"获取收藏列表失败")}catch(s){throw console.error("获取收藏列表失败:",s),new Error(s.message||"网络错误")}}static async search(s){return this.getAll({search:s})}static async getByDynasty(s){return this.getAll({dynasty:s})}static async getStats(){try{const s=await x.get("/poems/stats/overview");if(s.success)return s.data;throw new Error(s.message||"获取统计信息失败")}catch(s){throw console.error("获取统计信息失败:",s),new Error(s.message||"网络错误")}}static async checkConnection(){try{return(await ce.get("/health")).success===!0}catch(s){return console.error("服务器连接检查失败:",s),!1}}}const Ke=de({__name:"OnlineSearch",props:{show:{type:Boolean,required:!0}},emits:["close","add-poems"],setup(u,{expose:s,emit:n}){s();const t=u,F=n,b=g(""),m=g(!1),k=g([]),w=g(0),C=g(1),D=g(10),h=g(!1),E=g([]),f=g(null),a=M(()=>k.value.length<w.value),v=async()=>{if(!(!b.value.trim()||m.value)){f.value&&f.value.abort(),f.value=new AbortController,m.value=!0,h.value=!0,C.value=1,k.value=[],E.value=[];try{const y=await le({keyword:b.value.trim(),page:C.value,limit:D.value},f.value.signal),P="data"in y?y.data:y;k.value=P.poems,w.value=P.total}catch(y){y.message!=="搜索已取消"&&console.error("搜索失败:",y)}finally{m.value=!1}}},L=async()=>{if(!(!a.value||m.value)){m.value=!0,C.value++;try{const y=await le({keyword:b.value.trim(),page:C.value,limit:D.value}),P="data"in y?y.data:y;k.value.push(...P.poems)}catch(y){console.error("加载更多失败:",y),C.value--}finally{m.value=!1}}},K=y=>{E.value.includes(y.id)||(E.value.push(y.id),F("add-poems",[y]))};ue(()=>{f.value&&f.value.abort()});const B={props:t,emit:F,searchKeyword:b,loading:m,searchResults:k,totalResults:w,currentPage:C,currentLimit:D,hasSearched:h,addedPoemIds:E,abortController:f,canLoadMore:a,handleSearch:v,loadMore:L,handleAddPoem:K};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),qe={class:"search-container"},ze={class:"search-header"},Ue={class:"search-form"},Ve={class:"search-input-group"},Ne=["disabled"],He={key:0,class:"search-results"},Qe={key:0,class:"loading"},Je={key:1,class:"results-list"},Ge={class:"results-header"},We={class:"poem-info"},Xe={class:"poem-header"},Ye={class:"poem-title"},Ze={class:"poem-author"},$e={class:"poem-preview"},et={class:"poem-actions"},tt=["onClick","disabled"],st={key:0,class:"pagination"},ot=["disabled"],at={key:1,class:"no-results"},it={key:2,class:"search-tips"};function nt(u,s,n,t,F,b){return n.show?(d(),c("div",{key:0,class:"online-search-modal",onClick:s[2]||(s[2]=O(m=>u.$emit("close"),["self"]))},[e("div",qe,[e("div",ze,[s[3]||(s[3]=e("h3",null,"在线搜索诗词",-1)),e("button",{class:"close-btn",onClick:s[0]||(s[0]=m=>u.$emit("close"))},"×")]),e("div",Ue,[e("div",Ve,[he(e("input",{"onUpdate:modelValue":s[1]||(s[1]=m=>t.searchKeyword=m),type:"text",placeholder:"请输入诗词标题、作者或关键词",class:"search-input",onKeyup:U(t.handleSearch,["enter"])},null,544),[[me,t.searchKeyword]]),e("button",{class:"search-btn",onClick:t.handleSearch,disabled:t.loading||!t.searchKeyword.trim()},l(t.loading?"搜索中...":"搜索"),9,Ne)])]),t.searchResults.length>0||t.loading?(d(),c("div",He,[t.loading?(d(),c("div",Qe,[...s[4]||(s[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在搜索诗词...",-1)])])):(d(),c("div",Je,[e("div",Ge,[e("span",null,"找到 "+l(t.totalResults)+" 首相关诗词",1)]),(d(!0),c(j,null,A(t.searchResults,m=>(d(),c("div",{key:m.id,class:"result-item"},[e("div",We,[e("div",Xe,[e("h4",Ye,l(m.title),1),e("span",Ze,l(m.author)+" · "+l(m.dynasty),1)]),e("p",$e,l(m.preview),1)]),e("div",et,[e("button",{class:"add-btn",onClick:k=>t.handleAddPoem(m),disabled:t.addedPoemIds.includes(m.id)},l(t.addedPoemIds.includes(m.id)?"已添加":"添加到主页"),9,tt)])]))),128)),t.totalResults>t.currentLimit?(d(),c("div",st,[e("button",{class:"page-btn",onClick:t.loadMore,disabled:t.loading}," 加载更多 ",8,ot)])):S("",!0)]))])):t.hasSearched&&!t.loading?(d(),c("div",at,[...s[5]||(s[5]=[e("p",null,"未找到相关诗词，请尝试其他关键词",-1)])])):S("",!0),t.hasSearched?S("",!0):(d(),c("div",it,[...s[6]||(s[6]=[e("h4",null,"搜索提示",-1),e("ul",null,[e("li",null,'可以搜索诗词标题，如"静夜思"、"望庐山瀑布"'),e("li",null,'可以搜索作者姓名，如"李白"、"杜甫"'),e("li",null,'可以搜索诗词内容关键词，如"月亮"、"春天"')],-1)])]))])])):S("",!0)}const rt=ve(Ke,[["render",nt],["__scopeId","data-v-4f07c5bd"],["__file","D:/杂物/peom/src/components/OnlineSearch.vue"]]),lt=de({__name:"Home",setup(u,{expose:s}){s();const n=xe(),t=Oe(),F=()=>{n.logout(),t.push("/login")},b=g([{image:"https://ai-public.mastergo.com/ai/img_res/23776e3560960f7d99c31016d8ac9358.jpg",line:"山重水复疑无路，柳暗花明又一村。",author:"陆游《游山西村》"},{image:"https://ai-public.mastergo.com/ai/img_res/e2b49700f4f05ac9961717d8205941f6.jpg",line:"大江东去，浪淘尽，千古风流人物。",author:"苏轼《念奴娇·赤壁怀古》"},{image:"https://ai-public.mastergo.com/ai/img_res/506bd9ac37829c9464c75b316c4224db.jpg",line:"举头望明月，低头思故乡。",author:"李白《静夜思》"}]),m=g([{name:"唐诗",description:"唐代诗歌，格律严谨，意境深远",icon:"📜"},{name:"宋词",description:"宋代词牌，婉约豪放，音律优美",icon:"🎵"},{name:"元曲",description:"元代散曲，通俗易懂，富有生活气息",icon:"🎭"},{name:"古风",description:"古代风格诗歌，包括汉魏六朝作品",icon:"🏛️"},{name:"现代诗",description:"现当代诗歌，形式自由，情感真挚",icon:"🆕"},{name:"乐府",description:"汉魏乐府诗，民间歌谣，叙事性强",icon:"🎶"},{name:"绝句",description:"四句诗体，言简意赅，意境完整",icon:"✂️"},{name:"律诗",description:"八句诗体，对仗工整，格律严谨",icon:"⚖️"}]),k=g(0),w=g(!1),C=g(!0),D=g(null),h=g([]),E=async()=>{try{console.log("🔄 开始加载诗词数据..."),C.value=!0,D.value=null,console.log("🔍 检查服务器连接...");const o=await T.checkConnection();console.log("🔗 服务器连接状态:",o),console.log("📚 从数据库获取诗词列表...");const i=await T.getAll();console.log("✅ 获取到诗词数据:",i.length,"首"),console.log("📋 诗词列表:",i),h.value=i,w.value=!0,i.length===0&&(console.log("📝 数据库为空，初始化默认数据..."),await a()),console.log("🎉 诗词数据加载完成!")}catch(o){console.error("❌ 加载诗词失败:",o),D.value=o.message||"加载诗词失败",console.log("🔄 使用本地默认数据"),w.value=!1,h.value=f()}finally{C.value=!1}},f=()=>[{title:"静夜思",author:"李白",dynasty:"唐代",content:"床前明月光，疑是地上霜。举头望明月，低头思故乡。",preview:"床前明月光，疑是地上霜。举头望明月，低头思故乡。",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg",is_favorite:!1},{title:"春晓",author:"孟浩然",dynasty:"唐代",content:"春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。",preview:"春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。",image:"https://ai-public.mastergo.com/ai/img_res/437f5006c8faaf74d6d7d4197e1d9482.jpg",is_favorite:!1},{title:"登鹳雀楼",author:"王之涣",dynasty:"唐代",content:"白日依山尽，黄河入海流。欲穷千里目，更上一层楼。",preview:"白日依山尽，黄河入海流。欲穷千里目，更上一层楼。",image:"https://ai-public.mastergo.com/ai/img_res/43e7125fe4023d89a1774e4416e1ace4.jpg",is_favorite:!1},{title:"江雪",author:"柳宗元",dynasty:"唐代",content:"千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。",preview:"千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。",image:"https://ai-public.mastergo.com/ai/img_res/f0be731204399b0b196cea3d7505fdd2.jpg",is_favorite:!1},{title:"水调歌头",author:"苏轼",dynasty:"宋代",content:"明月几时有？把酒问青天。不知天上宫阙，今夕是何年。",preview:"明月几时有？把酒问青天。不知天上宫阙，今夕是何年。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg",is_favorite:!1},{title:"声声慢",author:"李清照",dynasty:"宋代",content:"寻寻觅觅，冷冷清清，凄凄惨惨戚戚。乍暖还寒时候，最难将息。",preview:"寻寻觅觅，冷冷清清，凄凄惨惨戚戚。乍暖还寒时候，最难将息。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg",is_favorite:!1},{title:"天净沙·秋思",author:"马致远",dynasty:"元代",content:"枯藤老树昏鸦，小桥流水人家，古道西风瘦马。夕阳西下，断肠人在天涯。",preview:"枯藤老树昏鸦，小桥流水人家，古道西风瘦马。夕阳西下，断肠人在天涯。",image:"https://ai-public.mastergo.com/ai/img_res/156f26c1f21f943949d6e24ce6c4e10c.jpg",is_favorite:!1},{title:"上邪",author:"佚名",dynasty:"汉代",content:"上邪！我欲与君相知，长命无绝衰。山无陵，江水为竭，冬雷震震，夏雨雪，天地合，乃敢与君绝！",preview:"上邪！我欲与君相知，长命无绝衰。山无陵，江水为竭，冬雷震震，夏雨雪，天地合，乃敢与君绝！",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg",is_favorite:!1},{title:"再别康桥",author:"徐志摩",dynasty:"现代",content:"轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。",preview:"轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。",image:"https://ai-public.mastergo.com/ai/img_res/437f5006c8faaf74d6d7d4197e1d9482.jpg",is_favorite:!1},{title:"长歌行",author:"佚名",dynasty:"汉代",content:"青青园中葵，朝露待日晞。阳春布德泽，万物生光辉。常恐秋节至，焜黄华叶衰。百川东到海，何时复西归？少壮不努力，老大徒伤悲！",preview:"青青园中葵，朝露待日晞。阳春布德泽，万物生光辉。常恐秋节至，焜黄华叶衰。百川东到海，何时复西归？少壮不努力，老大徒伤悲！",image:"https://ai-public.mastergo.com/ai/img_res/43e7125fe4023d89a1774e4416e1ace4.jpg",is_favorite:!1},{title:"相思",author:"王维",dynasty:"唐代",content:"红豆生南国，春来发几枝。愿君多采撷，此物最相思。",preview:"红豆生南国，春来发几枝。愿君多采撷，此物最相思。",image:"https://ai-public.mastergo.com/ai/img_res/f0be731204399b0b196cea3d7505fdd2.jpg",is_favorite:!1},{title:"望岳",author:"杜甫",dynasty:"唐代",content:"岱宗夫如何？齐鲁青未了。造化钟神秀，阴阳割昏晓。荡胸生曾云，决眦入归鸟。会当凌绝顶，一览众山小。",preview:"岱宗夫如何？齐鲁青未了。造化钟神秀，阴阳割昏晓。荡胸生曾云，决眦入归鸟。会当凌绝顶，一览众山小。",image:"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg",is_favorite:!1}],a=async()=>{try{const o=f(),i=await T.createBatch(o);h.value=i,console.log("默认诗词初始化完成")}catch(o){throw console.error("初始化默认诗词失败:",o),o}},v=g(!1),L=async o=>{try{const i=new Set(h.value.map(_=>`${_.title}-${_.author}`)),r=o.filter(_=>!i.has(`${_.title}-${_.author}`));if(r.length>0){const _=r.map(p=>({title:p.title,author:p.author,dynasty:p.dynasty,content:p.content||p.preview,preview:p.preview||p.content,image:p.image||"https://ai-public.mastergo.com/ai/img_res/48599143c45e1b4cb1d0cd756388f738.jpg",is_favorite:!1}));if(w.value){const p=await T.createBatch(_);h.value=[...h.value,...p]}else h.value=[...h.value,..._];alert(`成功添加 ${r.length} 首诗词！`),v.value=!1}else alert("所选诗词已存在，未添加重复内容。")}catch(i){console.error("添加诗词失败:",i),alert(`添加诗词失败: ${i.message}`)}},K=g(!1),B=g(null),y=g(null);let P=null;const ge=async()=>{if(I.value){K.value=!0,B.value=null,y.value=null,P==null||P.abort(),P=new AbortController;try{const o=await Te({title:I.value.title,author:I.value.author,dynasty:I.value.dynasty,content:I.value.content||I.value.preview||""},P.signal);y.value=o}catch(o){B.value=(o==null?void 0:o.message)||"鉴赏失败，请稍后重试"}finally{K.value=!1}}},V=g(!1),N=g(""),_e=()=>V.value=!V.value,ye=()=>N.value="",H=(o,i)=>{switch(o){case"唐诗":return i.filter(r=>r.dynasty.includes("唐"));case"宋词":return i.filter(r=>r.dynasty.includes("宋"));case"元曲":return i.filter(r=>r.dynasty.includes("元"));case"古风":return i.filter(r=>r.dynasty.includes("唐")||r.dynasty.includes("汉")||r.dynasty.includes("魏晋")||r.dynasty.includes("先秦"));case"现代诗":return i.filter(r=>r.dynasty.includes("现代")||r.dynasty.includes("当代")||r.dynasty.includes("民国"));case"乐府":return i.filter(r=>r.dynasty.includes("汉")||r.dynasty.includes("魏晋")||r.dynasty.includes("南北朝"));case"绝句":return i.filter(r=>(r.content||r.preview).split(/[，。；！？]/).filter(p=>p.trim()).length===4);case"律诗":return i.filter(r=>(r.content||r.preview).split(/[，。；！？]/).filter(p=>p.trim()).length===8);default:return i}},fe=M(()=>{const o=N.value.trim(),i=m.value[k.value];let r=H(i.name,h.value);return o&&(r=r.filter(_=>[_.title,_.author,_.dynasty,_.preview||_.content].some(p=>p==null?void 0:p.toLowerCase().includes(o.toLowerCase())))),r}),Y=M(()=>h.value.length),Z=M(()=>h.value.filter(o=>!!o.is_favorite).length),$=M(()=>{const o={};return m.value.forEach(i=>{o[i.name]=H(i.name,h.value).length}),o}),ee=M(()=>{const o={};return h.value.forEach(i=>{o[i.dynasty]=(o[i.dynasty]||0)+1}),Object.entries(o).map(([i,r])=>({dynasty:i,count:r})).sort((i,r)=>r.count-i.count).slice(0,5)}),be=()=>{const o={poems:h.value,favorites:se.value,stats:{totalCount:Y.value,favoritesCount:Z.value,categoryCounts:$.value,topDynasties:ee.value},exportTime:new Date().toISOString()},i=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),r=URL.createObjectURL(i),_=document.createElement("a");_.href=r,_.download=`poem-data-${new Date().toISOString().split("T")[0]}.json`,_.click(),URL.revokeObjectURL(r),alert("数据导出成功！")},we=async()=>{if(confirm("确定要清空所有收藏吗？此操作不可撤销。"))try{if(w.value){const o=h.value.filter(i=>i.is_favorite&&i.id);for(const i of o)await T.toggleFavorite(i.id)}else h.value.forEach(o=>{o.is_favorite=!1});alert("收藏已清空！")}catch(o){console.error("清空收藏失败:",o),alert(`清空收藏失败: ${o.message}`)}},pe=async()=>{await E(),alert("数据刷新完成！")},te=o=>!!o.is_favorite,ke=async o=>{try{if(w.value&&o.id){const i=await T.toggleFavorite(o.id),r=h.value.findIndex(_=>_.id===o.id);r!==-1&&(h.value[r]={...h.value[r],...i,is_favorite:!!i.is_favorite})}else{const i=h.value.findIndex(r=>r.title===o.title&&r.author===o.author);i!==-1&&(h.value[i].is_favorite=!h.value[i].is_favorite)}}catch(i){console.error("切换收藏状态失败:",i),alert(`操作失败: ${i.message}`)}},se=M(()=>h.value.filter(o=>te(o))),Ce=async o=>{if(confirm(`确定要删除诗词《${o.title}》吗？`))try{w.value&&o.id&&await T.delete(o.id);const i=h.value.findIndex(r=>o.id?r.id===o.id:r.title===o.title&&r.author===o.author);i!==-1&&h.value.splice(i,1),alert("诗词删除成功！")}catch(i){console.error("删除诗词失败:",i),alert(`删除失败: ${i.message}`)}},Se=g([{icon:"🏠",text:"首页"},{icon:"📚",text:"分类"},{icon:"❤️",text:"收藏"},{icon:"👤",text:"我的"}]),Q=g(0),Pe=o=>Q.value=o,je=()=>window.history.length>1?window.history.back():alert("没有上一页"),Ee=o=>k.value=o,Le=o=>{Q.value=0,k.value=o,window.scrollTo({top:0,behavior:"smooth"})},I=g(null),J=g(!1),De=o=>{I.value=o,J.value=!0,y.value=null,B.value=null},Fe=()=>{J.value=!1,I.value=null,P&&(P.abort(),P=null)},q=g(0),oe=g(null);let R=null;const G=o=>{var r;q.value=o;const i=(r=oe.value)==null?void 0:r.children.item(o);i==null||i.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},ae=()=>G((q.value+1)%b.value.length),Ae=()=>G((q.value-1+b.value.length)%b.value.length),W=()=>{R=window.setInterval(ae,5e3)},ie=()=>{R&&(clearInterval(R),R=null)},Ie=()=>{R||W()};Be(async()=>{W(),await E()}),ue(()=>{ie()});const ne={authStore:n,router:t,handleLogout:F,carouselItems:b,categories:m,activeCategory:k,isServerConnected:w,isLoading:C,errorMessage:D,poems:h,loadPoemsFromDatabase:E,getDefaultPoems:f,initializeDefaultPoems:a,showOnlineSearch:v,handleAddPoems:L,appreciationLoading:K,appreciationError:B,appreciation:y,get appreciationAbort(){return P},set appreciationAbort(o){P=o},fetchAppreciation:ge,showSearch:V,searchQuery:N,toggleSearch:_e,clearSearch:ye,getFilteredPoemsByCategory:H,filteredPoems:fe,totalCount:Y,favoritesCount:Z,categoryCounts:$,topDynasties:ee,exportData:be,clearAllFavorites:we,refreshData:pe,isFav:te,toggleFav:ke,favList:se,deletePoem:Ce,footerItems:Se,activeFooter:Q,switchTab:Pe,goBack:je,selectCategory:Ee,viewCategoryPoems:Le,selectedPoem:I,showDetail:J,viewPoemDetail:De,closeDetail:Fe,activeSlide:q,carouselTrack:oe,get timer(){return R},set timer(o){R=o},jumpSlide:G,nextSlide:ae,prevSlide:Ae,startAuto:W,pauseCarousel:ie,resumeCarousel:Ie,OnlineSearch:rt};return Object.defineProperty(ne,"__isScriptSetup",{enumerable:!1,value:!0}),ne}}),ct={class:"page"},dt={class:"header"},ut={class:"header-actions"},vt={class:"user-info"},ht={class:"username"},mt={key:0,class:"search-bar"},gt=["onKeydown"],_t={class:"carousel-track",ref:"carouselTrack"},yt=["src"],ft={class:"carousel-text"},bt={class:"poem-line"},wt={class:"author"},pt={class:"dots"},kt=["onClick","aria-label"],Ct={class:"category-scroll",role:"tablist","aria-label":"分类导航"},St={class:"category-container"},Pt=["onClick","aria-selected","title"],jt={key:1,class:"status-bar"},Et={key:2,class:"loading-overlay"},Lt={class:"content-list"},Dt=["onClick","aria-label"],Ft=["src","alt"],At={class:"poem-info"},It={class:"poem-title"},xt={class:"poem-actions"},Ot=["aria-pressed","onClick","title"],Bt=["onClick"],Rt={class:"poem-author"},Tt={class:"poem-preview"},Mt={key:0,class:"empty"},Kt={key:1,class:"category-panel"},qt={class:"category-grid"},zt=["onClick"],Ut={class:"category-icon"},Vt={class:"category-info"},Nt={class:"category-count"},Ht={class:"category-desc"},Qt=["onClick"],Jt=["src","alt"],Gt={class:"poem-info"},Wt={class:"poem-title"},Xt={class:"poem-actions"},Yt=["onClick"],Zt=["onClick"],$t={class:"poem-author"},es={class:"poem-preview"},ts={key:0,class:"empty"},ss={key:3,class:"profile-panel"},os={class:"user-card"},as={class:"user-info"},is={class:"user-desc"},ns={key:0},rs={class:"stats-grid"},ls={class:"stat-card"},cs={class:"stat-info"},ds={class:"stat-number"},us={class:"stat-card"},vs={class:"stat-info"},hs={class:"stat-number"},ms={class:"stat-card"},gs={class:"stat-info"},_s={class:"stat-number"},ys={class:"stat-card"},fs={class:"stat-info"},bs={class:"stat-number"},ws={class:"chart-section"},ps={class:"chart-container"},ks=["title"],Cs={class:"chart-label"},Ss={class:"chart-count"},Ps={class:"dynasty-section"},js={class:"dynasty-tags"},Es={class:"footer",role:"tablist","aria-label":"底部导航"},Ls=["onClick","aria-selected"],Ds={class:"footer-icon"},Fs={class:"modal"},As={class:"modal-header"},Is={class:"modal-actions"},xs=["disabled"],Os={class:"modal-body"},Bs=["src","alt"],Rs={class:"modal-author"},Ts={class:"modal-preview"},Ms={key:0,class:"appreciation"},Ks={key:0,class:"loading"},qs={key:1,class:"error"},zs={class:"block"},Us={class:"block-content"},Vs={class:"block"},Ns={class:"block-content"},Hs={class:"block"},Qs={class:"block-content"},Js={class:"block"},Gs={class:"block-content"};function Ws(u,s,n,t,F,b){var m,k,w,C,D,h,E,f;return d(),c("div",ct,[e("div",dt,[e("button",{class:"icon-btn",onClick:t.goBack,"aria-label":"返回"},"←"),s[4]||(s[4]=e("div",{class:"title"},"诗词鉴赏",-1)),e("div",ut,[e("button",{class:"icon-btn",onClick:t.toggleSearch,"aria-label":"搜索"},"🔍"),e("div",vt,[e("span",ht,"👤 "+l((m=t.authStore.user)==null?void 0:m.username),1),e("button",{class:"logout-btn",onClick:t.handleLogout,title:"退出登录"},"退出")])])]),t.showSearch?(d(),c("div",mt,[he(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.searchQuery=a),type:"text",class:"search-input",placeholder:"搜索：标题/作者/朝代/内容",onKeydown:s[1]||(s[1]=U(a=>t.showSearch=!1,["esc"])),"aria-label":"搜索输入"},null,544),[[me,t.searchQuery]]),e("button",{class:"search-clear",onClick:t.clearSearch},"清空"),e("button",{class:"online-search-btn",onClick:s[2]||(s[2]=a=>t.showOnlineSearch=!0)},"在线搜索")])):S("",!0),e("div",{class:"carousel",onMouseenter:t.pauseCarousel,onMouseleave:t.resumeCarousel,onKeydown:[U(O(t.prevSlide,["prevent"]),["left"]),U(O(t.nextSlide,["prevent"]),["right"])],tabindex:"0","aria-label":"轮播图"},[e("div",_t,[(d(!0),c(j,null,A(t.carouselItems,(a,v)=>(d(),c("div",{class:"carousel-item",key:v},[e("img",{src:a.image,class:"carousel-image",alt:"轮播图片"},null,8,yt),e("div",ft,[e("div",bt,l(a.line),1),e("div",wt,l(a.author),1)])]))),128))],512),e("div",pt,[(d(!0),c(j,null,A(t.carouselItems,(a,v)=>(d(),c("button",{key:v,class:z(["dot",{active:v===t.activeSlide}]),onClick:L=>t.jumpSlide(v),"aria-label":`跳转到第${v+1}张`},null,10,kt))),128))])],40,gt),e("div",Ct,[e("div",St,[(d(!0),c(j,null,A(t.categories,(a,v)=>(d(),c("button",{key:v,class:z(["category-item",{active:t.activeCategory===v}]),onClick:L=>t.selectCategory(v),role:"tab","aria-selected":t.activeCategory===v,title:a.description},l(a.icon)+" "+l(a.name),11,Pt))),128))])]),t.isServerConnected?S("",!0):(d(),c("div",jt,[...s[5]||(s[5]=[e("div",{class:"status-warning"}," ⚠️ 数据库未连接，当前使用本地数据 ",-1)])])),t.isLoading?(d(),c("div",Et,[...s[6]||(s[6]=[e("div",{class:"loading-content"},[e("div",{class:"spinner"}),e("p",null,"正在加载诗词...")],-1)])])):S("",!0),e("div",Lt,[t.activeFooter===0?(d(),c(j,{key:0},[(d(!0),c(j,null,A(t.filteredPoems,(a,v)=>(d(),c("div",{class:"poem-card",key:v,onClick:L=>t.viewPoemDetail(a),"aria-label":`查看诗词：${a.title}`},[e("img",{src:a.image,class:"poem-image",alt:a.title},null,8,Ft),e("div",At,[e("div",It,[X(l(a.title)+" ",1),e("div",xt,[e("button",{class:"fav-btn","aria-pressed":t.isFav(a),onClick:O(L=>t.toggleFav(a),["stop"]),title:t.isFav(a)?"取消收藏":"收藏"},l(t.isFav(a)?"💛":"🤍"),9,Ot),t.isServerConnected?(d(),c("button",{key:0,class:"delete-btn",onClick:O(L=>t.deletePoem(a),["stop"]),title:"删除诗词"}," 🗑️ ",8,Bt)):S("",!0)])]),e("div",Rt,l(a.author)+" · "+l(a.dynasty),1),e("div",Tt,l(a.preview),1)])],8,Dt))),128)),t.filteredPoems.length===0?(d(),c("div",Mt,"未找到相关诗词")):S("",!0)],64)):t.activeFooter===1?(d(),c("div",Kt,[s[7]||(s[7]=e("h3",null,"诗词分类",-1)),e("div",qt,[(d(!0),c(j,null,A(t.categories,(a,v)=>(d(),c("div",{key:v,class:"category-card",onClick:L=>t.viewCategoryPoems(v)},[e("div",Ut,l(a.icon),1),e("div",Vt,[e("h4",null,l(a.name),1),e("p",Nt,l(t.categoryCounts[a.name])+" 首",1),e("p",Ht,l(a.description),1)])],8,zt))),128))]),s[8]||(s[8]=e("p",{class:"hint"},"点击分类卡片，将直接跳转到对应分类的诗词页面；右上角可搜索标题/作者/朝代/内容。",-1))])):t.activeFooter===2?(d(),c(j,{key:2},[(d(!0),c(j,null,A(t.favList,(a,v)=>(d(),c("div",{class:"poem-card",key:v,onClick:L=>t.viewPoemDetail(a)},[e("img",{src:a.image,class:"poem-image",alt:a.title},null,8,Jt),e("div",Gt,[e("div",Wt,[X(l(a.title)+" ",1),e("div",Xt,[e("button",{class:"fav-btn",onClick:O(L=>t.toggleFav(a),["stop"])},"💛",8,Yt),t.isServerConnected?(d(),c("button",{key:0,class:"delete-btn",onClick:O(L=>t.deletePoem(a),["stop"]),title:"删除诗词"}," 🗑️ ",8,Zt)):S("",!0)])]),e("div",$t,l(a.author)+" · "+l(a.dynasty),1),e("div",es,l(a.preview),1)])],8,Qt))),128)),t.favList.length===0?(d(),c("div",ts,"还没有收藏的诗词")):S("",!0)],64)):(d(),c("div",ss,[e("div",os,[s[9]||(s[9]=e("div",{class:"user-avatar"},"📚",-1)),e("div",as,[e("h3",null,l(t.authStore.isAuthenticated?(k=t.authStore.user)==null?void 0:k.username:"诗词爱好者"),1),e("p",is,[X(l(t.authStore.isAuthenticated?"欢迎回来！":"请先登录以使用完整功能")+" ",1),t.totalCount>0?(d(),c("span",ns,"已收录 "+l(t.totalCount)+" 首诗词",1)):S("",!0)])])]),t.authStore.isAuthenticated?(d(),c(j,{key:0},[e("div",rs,[e("div",ls,[s[11]||(s[11]=e("div",{class:"stat-icon"},"📖",-1)),e("div",cs,[e("div",ds,l(t.totalCount),1),s[10]||(s[10]=e("div",{class:"stat-label"},"诗词总数",-1))])]),e("div",us,[s[13]||(s[13]=e("div",{class:"stat-icon"},"❤️",-1)),e("div",vs,[e("div",hs,l(t.favoritesCount),1),s[12]||(s[12]=e("div",{class:"stat-label"},"收藏数量",-1))])]),e("div",ms,[s[15]||(s[15]=e("div",{class:"stat-icon"},"🏷️",-1)),e("div",gs,[e("div",_s,l(Object.keys(t.categoryCounts).length),1),s[14]||(s[14]=e("div",{class:"stat-label"},"分类数量",-1))])]),e("div",ys,[s[17]||(s[17]=e("div",{class:"stat-icon"},"📊",-1)),e("div",fs,[e("div",bs,l(Math.round(t.favoritesCount/t.totalCount*100)||0)+"%",1),s[16]||(s[16]=e("div",{class:"stat-label"},"收藏比例",-1))])])]),e("div",ws,[s[18]||(s[18]=e("h4",null,"📈 分类分布",-1)),e("div",ps,[(d(!0),c(j,null,A(t.categories,(a,v)=>(d(),c("div",{key:v,class:"chart-bar",style:re({width:`${t.categoryCounts[a.name]/t.totalCount*100||0}%`}),title:`${a.name}: ${t.categoryCounts[a.name]} 首`},[e("span",Cs,l(a.icon)+" "+l(a.name),1),e("span",Ss,l(t.categoryCounts[a.name]),1)],12,ks))),128))])]),e("div",Ps,[s[19]||(s[19]=e("h4",null,"🏛️ 热门朝代",-1)),e("div",js,[(d(!0),c(j,null,A(t.topDynasties,(a,v)=>(d(),c("span",{key:v,class:z(["dynasty-tag",{"top-dynasty":v<3}])},l(a.dynasty)+" ("+l(a.count)+") ",3))),128))])]),e("div",{class:"quick-actions"},[s[20]||(s[20]=e("h4",null,"⚡ 快速操作",-1)),e("div",{class:"action-buttons"},[e("button",{class:"action-btn",onClick:t.exportData}," 📥 导出数据 "),e("button",{class:"action-btn",onClick:t.clearAllFavorites}," 🗑️ 清空收藏 "),e("button",{class:"action-btn",onClick:t.refreshData}," 🔄 刷新数据 ")])])],64)):S("",!0)]))]),e("div",Es,[(d(!0),c(j,null,A(t.footerItems,(a,v)=>(d(),c("div",{class:z(["footer-item",{active:t.activeFooter===v}]),key:v,onClick:L=>t.switchTab(v),role:"tab","aria-selected":t.activeFooter===v},[e("div",Ds,l(a.icon),1),e("div",{class:"footer-text",style:re({color:t.activeFooter===v?"#c9a76f":"#999"})},l(a.text),5)],10,Ls))),128))]),t.showDetail?(d(),c("div",{key:3,class:"modal-mask",onClick:O(t.closeDetail,["self"]),"aria-modal":"true",role:"dialog"},[e("div",Fs,[e("div",As,[e("h4",null,l((w=t.selectedPoem)==null?void 0:w.title),1),e("div",Is,[e("button",{class:"action-btn",onClick:t.fetchAppreciation,disabled:t.appreciationLoading},l(t.appreciationLoading?"鉴赏中…":"智能鉴赏"),9,xs),e("button",{class:"icon-btn",onClick:t.closeDetail,"aria-label":"关闭"},"✖")])]),e("div",Os,[e("img",{src:(C=t.selectedPoem)==null?void 0:C.image,class:"modal-image",alt:(D=t.selectedPoem)==null?void 0:D.title},null,8,Bs),e("p",Rs,l((h=t.selectedPoem)==null?void 0:h.author)+" · "+l((E=t.selectedPoem)==null?void 0:E.dynasty),1),e("p",Ts,l((f=t.selectedPoem)==null?void 0:f.preview),1),t.appreciation||t.appreciationLoading||t.appreciationError?(d(),c("div",Ms,[s[25]||(s[25]=e("h5",null,"诗词鉴赏",-1)),t.appreciationLoading?(d(),c("div",Ks,"正在解析诗词意境与修辞…")):t.appreciationError?(d(),c("div",qs,l(t.appreciationError),1)):t.appreciation?(d(),c(j,{key:2},[e("section",zs,[s[21]||(s[21]=e("div",{class:"block-title"},"意境与情感",-1)),e("p",Us,l(t.appreciation.mood),1)]),e("section",Vs,[s[22]||(s[22]=e("div",{class:"block-title"},"修辞与技巧",-1)),e("p",Ns,l(t.appreciation.rhetoric),1)]),e("section",Hs,[s[23]||(s[23]=e("div",{class:"block-title"},"创作背景",-1)),e("p",Qs,l(t.appreciation.background),1)]),e("section",Js,[s[24]||(s[24]=e("div",{class:"block-title"},"综合点评",-1)),e("p",Gs,l(t.appreciation.commentary),1)])],64)):S("",!0)])):S("",!0)])])])):S("",!0),Re(t.OnlineSearch,{show:t.showOnlineSearch,onClose:s[3]||(s[3]=a=>t.showOnlineSearch=!1),onAddPoems:t.handleAddPoems},null,8,["show"])])}const Ys=ve(lt,[["render",Ws],["__scopeId","data-v-bd9bb22b"],["__file","D:/杂物/peom/src/pages/home/Home.vue"]]);export{Ys as default};
