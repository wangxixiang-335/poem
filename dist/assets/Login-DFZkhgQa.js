import{h as g,d as B,u as q,a as T,r as c,c as A,o as D,_ as N,b as v,e as t,n as x,w as P,f as _,g as w,v as b,t as y,i as I,j as f}from"./index-CSK4OVOp.js";const R={async sendVerificationCode(n){try{return await g.post("/auth/send-verification",n)}catch(e){throw console.error("发送验证码失败:",e),e}},async register(n){try{return await g.post("/auth/register",n)}catch(e){throw console.error("注册失败:",e),e}},async login(n){try{return await g.post("/auth/login",n)}catch(e){throw console.error("登录失败:",e),e}},async getCurrentUser(){try{return await g.get("/auth/me")}catch(n){throw console.error("获取用户信息失败:",n),n}},async updateProfile(n){try{return await g.put("/auth/profile",n)}catch(e){throw console.error("更新用户信息失败:",e),e}},logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")}},j=B({__name:"Login",setup(n,{expose:e}){e();const h=q(),o=T(),i=c(!0),d=c(!1),r=c(""),u=c(!1),m=c(0);let s=null;const a=c({username:"",email:"",password:"",verificationCode:""}),C=A(()=>!(!a.value.email||!a.value.password||!i.value&&!a.value.username||!i.value&&a.value.password.length<6||!i.value&&u.value&&!a.value.verificationCode)),V=async()=>{if(!a.value.email){r.value="请输入邮箱地址";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.value.email)){r.value="邮箱格式不正确";return}d.value=!0,r.value="";try{const l=await R.sendVerificationCode({email:a.value.email});l.success?(u.value=!0,k(),l.testCode&&(console.log("验证码:",l.testCode),alert(`测试验证码: ${l.testCode}`))):r.value=l.message||"发送验证码失败"}catch(l){r.value=l.message||"网络异常，请稍后重试"}finally{d.value=!1}},k=()=>{m.value=60,s=setInterval(()=>{m.value--,m.value<=0&&s&&(clearInterval(s),s=null)},1e3)},L=async()=>{if(C.value){d.value=!0,r.value="";try{if(i.value)await o.login({email:a.value.email,password:a.value.password});else{if(!u.value){await V();return}await o.register({username:a.value.username,email:a.value.email,password:a.value.password,verificationCode:a.value.verificationCode})}h.push("/home")}catch(p){r.value=p.message||"操作失败，请稍后重试"}finally{d.value=!1}}},M=()=>{i.value=!i.value,u.value=!1,a.value={username:"",email:"",password:"",verificationCode:""},r.value="",s&&(clearInterval(s),s=null),m.value=0},U=()=>i.value?"登录":u.value?"注册":"发送验证码";D(()=>{s&&clearInterval(s)});const S={router:h,authStore:o,isLogin:i,loading:d,error:r,showVerificationStep:u,countdown:m,get countdownInterval(){return s},set countdownInterval(p){s=p},form:a,isFormValid:C,sendVerificationCode:V,startCountdown:k,handleSubmit:L,toggleMode:M,getButtonText:U};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),F={class:"login-container"},z={class:"login-card"},E={class:"login-tabs"},O={key:0,class:"form-group"},G=["disabled"],H={class:"form-group"},J=["disabled"],K={class:"form-group"},Q=["placeholder","disabled"],W={key:1,class:"form-group"},X={class:"verification-input-group"},Y=["disabled"],Z=["disabled"],$={key:2,class:"error-message"},ee=["disabled"],oe={class:"login-footer"},te={key:0},re={key:1};function ae(n,e,h,o,i,d){return f(),v("div",F,[t("div",z,[e[11]||(e[11]=t("div",{class:"login-header"},[t("h1",null,"诗词鉴赏系统"),t("p",null,"请登录以继续使用")],-1)),t("div",E,[t("button",{class:x(["tab-btn",{active:o.isLogin}]),onClick:o.toggleMode}," 登录 ",2),t("button",{class:x(["tab-btn",{active:!o.isLogin}]),onClick:o.toggleMode}," 注册 ",2)]),t("form",{onSubmit:P(o.handleSubmit,["prevent"]),class:"login-form"},[o.isLogin?_("",!0):(f(),v("div",O,[e[4]||(e[4]=t("label",{for:"username"},"用户名",-1)),w(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=r=>o.form.username=r),type:"text",placeholder:"请输入用户名",required:"",disabled:o.loading||o.showVerificationStep},null,8,G),[[b,o.form.username]])])),t("div",H,[e[5]||(e[5]=t("label",{for:"email"},"邮箱",-1)),w(t("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=r=>o.form.email=r),type:"email",placeholder:"请输入邮箱地址",required:"",disabled:o.loading||o.showVerificationStep},null,8,J),[[b,o.form.email]])]),t("div",K,[e[6]||(e[6]=t("label",{for:"password"},"密码",-1)),w(t("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=r=>o.form.password=r),type:"password",placeholder:o.isLogin?"请输入密码":"请设置密码（至少6位）",required:"",disabled:o.loading||o.showVerificationStep},null,8,Q),[[b,o.form.password]])]),!o.isLogin&&o.showVerificationStep?(f(),v("div",W,[e[7]||(e[7]=t("label",{for:"verificationCode"},"验证码",-1)),t("div",X,[w(t("input",{id:"verificationCode","onUpdate:modelValue":e[3]||(e[3]=r=>o.form.verificationCode=r),type:"text",placeholder:"请输入6位验证码",maxlength:"6",required:"",disabled:o.loading},null,8,Y),[[b,o.form.verificationCode]]),t("button",{type:"button",class:"send-code-btn",disabled:o.countdown>0||o.loading,onClick:o.sendVerificationCode},y(o.countdown>0?`${o.countdown}秒后重试`:"发送验证码"),9,Z)]),e[8]||(e[8]=t("p",{class:"verification-hint"},"验证码已发送到您的邮箱，请查收",-1))])):_("",!0),o.error?(f(),v("div",$,y(o.error),1)):_("",!0),t("button",{type:"submit",class:"submit-btn",disabled:o.loading||!o.isFormValid},y(o.loading?"处理中...":o.getButtonText()),9,ee)],32),t("div",oe,[o.isLogin?(f(),v("p",te,[e[9]||(e[9]=I(" 还没有账号？",-1)),t("button",{class:"link-btn",onClick:o.toggleMode},"立即注册")])):(f(),v("p",re,[e[10]||(e[10]=I(" 已有账号？",-1)),t("button",{class:"link-btn",onClick:o.toggleMode},"立即登录")]))])])])}const se=N(j,[["render",ae],["__scopeId","data-v-ce5bbc91"],["__file","D:/杂物/peom/src/pages/login/Login.vue"]]);export{se as default};
